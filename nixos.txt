How do I remove older generations from the bootloader?
First, collect garbages in your system, then rebuild. The scripts will collect leftover files.

The first command, in the example below, removes everything older than 14 days.

sudo nix-collect-garbage --delete-older-than 14d 
sudo nixos-rebuild boot

Поколения
Каждый раз, когда состояние системы перестраивается с помощью nixos-rebuild switch, создается новое поколение. Вы можете вернуться к предыдущему поколению в любое время, 
что полезно, если изменение конфигурации (или обновление системы) оказывается вредным.

Вы можете откатиться через:

$ nix-env --rollback                # откатить пользовательскую среду 
$ nixos-rebuild switch --rollback   # откатить системную среду
NixOS также помещает записи для предыдущих поколений в меню загрузчика, так что в качестве последнего средства вы всегда можете вернуться к предыдущей конфигурации путем перезагрузки.

Поскольку NixOS поддерживает доступность предыдущих поколений состояния системы в случае необходимости отката, старые версии пакетов не удаляются из вашей системы сразу после обновления. 
Вы можете удалить старые поколения вручную:

# удалить поколения старше 30 дней
$ nix-collect-garbage --delete-старше-чем 30d

# удалить ВСЕ предыдущие поколения - вы больше не сможете откатываться после запуска этого
$ nix-collect-garbage -d
Вы можете настроить автоматическую сборку мусора, установив параметры nix.gc в /etc/nixos/configuration.nix. Это рекомендуется, так как это уменьшает размер хранилища Nix.


Может возникнуть вполне закономерен вопрос: а что происходит с хранилищем пакетов при удалении и обновлении пакетов? Происходит то, что ничего не происходит.
 Покуда существуют конфигурации, ссылающиеся на старые версии пакетов, они так и будут оставаться в системе нетронутыми. Это сделано, чтобы всегда иметь
  возможность откатиться на предыдущие конфигурации, если при очередном обновлении что-то сломалось.
Но имеющийся инструментарий позволяет чистить систему от ненужных конфигураций и старых версий пакетов:

# Удаляем все не текущие генерации
nix-env --delete-generations old
 
# Или можем удалить все старее прошлой недели
nix-env --delete-generations 7d
 
# Удаляем неиспользуемые пакеты из хранилища навсегда
nix-collect-garbage
Или глобально для всех профилей это же можно сделать так (разумеется от рута):
Или глобально для всех профилей это же можно сделать так (разумеется от рута):
# Удалить все не текущие
nix-collect-garbage --delete-old
 
# Или всё старше недели
nix-collect-garbage --delete-older-than 7d
